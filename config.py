"""
카카오 챗봇 설정 파일
"""
import os

# 기본 경로
BASE_DIR = os.path.dirname(os.path.abspath(__file__))
DATA_DIR = os.path.join(BASE_DIR, "data")
LOG_DIR = os.path.join(BASE_DIR, "logs")

# 디렉토리 자동 생성
os.makedirs(DATA_DIR, exist_ok=True)
os.makedirs(LOG_DIR, exist_ok=True)

# 데이터베이스 설정
DATABASE_PATH = os.path.join(DATA_DIR, "chatbot.db")

# 서버 설정
SERVER_HOST = "0.0.0.0"
SERVER_PORT = 5000

# 크롤링 대상 URL
URL_MAPPING = {
    "검사항목": {
        "식품": "https://www.biofl.co.kr/sub.jsp?code=7r9P7y94&question_241",
        "축산": "https://www.biofl.co.kr/sub.jsp?code=XN0Cd4r7&question_243"
    },
    "검사주기": {
        "식품": "https://www.biofl.co.kr/sub.jsp?code=7r9P7y94",
        "축산": "https://www.biofl.co.kr/sub.jsp?code=XN0Cd4r7"
    },
    "자가품질검사": {
        "검사주기알림": "https://www.biofl.co.kr/sub.jsp?code=7r9P7y94&question_198"
    },
    "영양성분검사": {
        "검사종류": "https://www.biofl.co.kr/sub.jsp?code=JEKb3KXA&question_207",
        "9대영양성분": "https://www.biofl.co.kr/sub.jsp?code=JEKb3KXA&question_193",
        "14대영양성분": "https://www.biofl.co.kr/sub.jsp?code=JEKb3KXA&question_192"
    },
    "소비기한설정": {
        "가속실험": "https://www.biofl.co.kr/sub.jsp?code=PXXBybSV&question_97",
        "실측실험": "https://www.biofl.co.kr/sub.jsp?code=PXXBybSV&question_97"
    },
    "항생물질": {
        "검사종류": "https://www.biofl.co.kr/sub.jsp?code=MKJ9PKO0&question_90"
    },
    "잔류농약": {
        "검사종류": "https://www.biofl.co.kr/sub.jsp?code=MKJ9PKO0&question_85"
    },
    "방사능": {
        "검사안내": "https://www.biofl.co.kr/sub.jsp?code=HY5KJJJI&question_39"
    },
    "비건": {
        "검사안내": "https://www.biofl.co.kr/sub.jsp?code=D4P8L2M7&question_185"
    },
    "할랄": {
        "검사안내": "https://www.biofl.co.kr/sub.jsp?code=D4P8L2M7&question_186"
    },
    "동물DNA": {
        "검사안내": "https://www.biofl.co.kr/sub.jsp?code=D4P8L2M7&question_127"
    },
    "알레르기": {
        "분석종류": "https://www.biofl.co.kr/sub.jsp?code=G7K3Y2F9&question_26",
        "RT-PCR": "https://www.biofl.co.kr/sub.jsp?code=G7K3Y2F9&question_251",
        "Elisa": "https://www.biofl.co.kr/sub.jsp?code=G7K3Y2F9&question_151"
    },
    "글루텐Free": {
        "Free기준": "https://www.biofl.co.kr/sub.jsp?code=EJ2GKW3&question_161"
    }
}

# 업종 매핑 (검사주기)
INDUSTRY_MAPPING = {
    "식품제조가공업": "question_236",
    "즉석판매제조가공업": "question_239",
    "축산물제조가공업": "question_240",
    "축산물즉석판매제조가공업": "question_246"
}

# 검사항목 팝업 ID 매핑
ITEM_POPUP_MAPPING = {
    "식품": "question_241",
    "축산": "question_243"
}

# 영양성분검사 팝업 ID 매핑
NUTRITION_POPUP_MAPPING = {
    "검사종류": "question_207",
    "9대영양성분": "question_193",
    "14대영양성분": "question_192"
}

# 일반 검사 팝업 ID 매핑 (카테고리 > 메뉴 > 팝업ID)
GENERAL_POPUP_MAPPING = {
    "자가품질검사": {
        "검사주기알림": "question_198"
    },
    "소비기한설정": {
        "가속실험": "question_97",
        "실측실험": "question_97"
    },
    "항생물질": {
        "검사종류": "question_90"
    },
    "잔류농약": {
        "검사종류": "question_85"
    },
    "방사능": {
        "검사안내": "question_39"
    },
    "비건": {
        "검사안내": "question_185"
    },
    "할랄": {
        "검사안내": "question_186"
    },
    "동물DNA": {
        "검사안내": "question_127"
    },
    "알레르기": {
        "분석종류": "question_26",
        "RT-PCR": "question_251",
        "Elisa": "question_151"
    },
    "글루텐Free": {
        "Free기준": "question_161"
    }
}

# 페이지 제목의 Q번호 매핑 (카테고리 > 메뉴 > 표시 Q번호)
# 실제 페이지에 표시되는 Q번호 (예: "Q1. 영양성분 표시 종류" → 1)
DISPLAY_Q_NUMBER = {
    "영양성분검사": {
        "검사종류": 1,       # Q1. 영양성분 표시 종류
        "표시대상확인": 2,   # Q2.
        "1회제공량산표": 3,  # Q3.
        "9대영양성분": 4,    # Q4.
        "14대영양성분": 5    # Q5.
    },
    "소비기한설정": {
        "가속실험": 2,       # Q2.
        "실측실험": 2        # Q2. (같은 페이지)
    },
    "항생물질": {
        "검사종류": 8        # Q8.
    },
    "잔류농약": {
        "검사종류": 3        # Q3.
    },
    "방사능": {
        "검사안내": 3        # Q3.
    },
    "비건": {
        "검사안내": 3        # Q3.
    },
    "할랄": {
        "검사안내": 6        # Q6.
    },
    "동물DNA": {
        "검사안내": 7        # Q7.
    },
    "알레르기": {
        "분석종류": 1,       # Q1.
        "RT-PCR": 8,         # Q8.
        "Elisa": 7           # Q7.
    },
    "글루텐Free": {
        "Free기준": 1
    },
    "자가품질검사": {
        "검사주기알림": 9    # Q9.
    }
}

# 섹션 필터 (특정 헤더만 포함)
# 같은 팝업에서 특정 섹션만 추출할 때 사용
SECTION_FILTER = {
    "소비기한설정": {
        "가속실험": "2) 가속실험",  # "2) 가속실험(3개월이상 제품)" 섹션만
        "실측실험": "1) 실측실험"   # "1) 실측실험 (3개월이내 제품)" 섹션만
    }
    # 알레르기 RT-PCR/Elisa는 이제 별도 페이지로 분리됨
}

# 스케줄러 설정 (매일 크롤링 시간)
CRAWL_HOUR = 5  # 오전 5시
CRAWL_MINUTE = 0

# 로깅 설정
LOG_FILE = os.path.join(LOG_DIR, "chatbot.log")
LOG_FORMAT = "%(asctime)s - %(levelname)s - %(message)s"

# Google Vision API 설정
GOOGLE_VISION_CREDENTIALS = os.environ.get("GOOGLE_APPLICATION_CREDENTIALS", "")
VISION_API_MONTHLY_LIMIT = 990  # 월별 API 호출 제한 (무료 1000건 중 여유분 제외)

# ===== 영양성분 표시대상 식품유형 데이터 =====
# 카테고리별 식품유형 및 시행일 정보

NUTRITION_LABEL_CATEGORIES = {
    # 기존 시행 - 즉시 적용
    "기존시행": {
        "개정일": "기존",
        "매출기준년도": None,
        "시행일": "즉시 적용",
        "식품유형": [
            "과자", "캔디류", "빵류", "아이스크림", "저지방아이스크림", "아이스밀크", "샤베트",
            "비유지방아이스크림", "빙과", "코코아매스", "코코아버터", "코코아분말", "기타코코아가공품",
            "초콜릿", "밀크초콜릿", "화이트초콜릿", "준초콜릿", "초콜릿가공품", "잼", "기타잼",
            "콩기름", "옥수수기름", "채종유", "미강유", "참기름", "추출참깨유", "들기름", "추출들깨유",
            "홍화유", "해바라기유", "목화씨기름", "땅콩기름", "올리브유", "팜유류", "야자유", "고추씨기름",
            "기타식물성유지", "혼합식용유", "향미유", "가공유지", "쇼트닝", "마가린", "생면", "숙면",
            "건면", "유탕면", "커피", "농축과채즙", "과채주스", "과채음료", "탄산음료", "탄산수",
            "원액두유", "가공두유", "유산균음료", "효모음료", "기타발효음료", "인삼홍삼음료", "혼합음료",
            "음료베이스", "영아용조제유", "성장기용조제유", "영아용조제식", "성장기용조제식",
            "영유아용이유식", "체중조절용식품", "임산수유부용식품", "고령자용영양조제식품",
            "일반환자용균형영양조제식품", "당뇨환자용영양조제식품", "신장질환자용영양조제식품",
            "장질환자용단백가수분해영양조제식품", "암환자용영양조제식품", "열량및영양공급용식품",
            "연하곤란자용점도조절식품", "선천성대사질환자용조제식품", "영유아용특수조제식품",
            "기타환자용영양조제식품", "당뇨환자용식단형식품", "신장질환자용식단형식품", "암환자용식단형식품",
            "개량메주", "한식간장", "양조간장", "산분해간장", "효소분해간장", "혼합간장", "된장",
            "고추장", "춘장", "혼합장", "기타장류", "시리얼", "햄", "생햄", "프레스햄", "소시지",
            "발효소시지", "혼합소시지", "우유", "환원유", "강화우유", "유산균첨가우유", "유당분해우유",
            "가공유", "발효유", "농후발효유", "크림발효유", "농후크림발효유", "발효버터유", "발효유분말",
            "자연치즈", "가공치즈", "전지분유", "탈지분유", "가당분유", "혼합분유", "어육소시지",
            "즉석섭취식품", "즉석조리식품", "만두류"
        ]
    },

    # 2021.05.27 개정 - 19년도 매출액 기준
    "2021개정": {
        "개정일": "2021.05.27",
        "근거": "식품 등의 표시·광고에 관한 법률 시행규칙 제1701호",
        "매출기준년도": 2019,
        "시행일_일반": {
            "120억이상": "2022.01.01",
            "50억이상_120억미만": "2024.01.01",
            "50억미만": "2026.01.01"
        },
        "시행일_배추김치": {
            "300억이상": "2022.01.01",
            "50억이상_300억미만": "2024.01.01",
            "50억미만": "2026.01.01"
        },
        "식품유형": [
            "떡류", "당류가공품", "두부", "유바", "가공두부", "묵류", "식물성크림", "액상차",
            "발효식초", "복합조미식품", "마요네즈", "토마토케첩", "소스", "카레", "향신료조제품",
            "김칫속", "배추김치", "절임식품", "당절임", "조림류", "전분", "전분가공품", "밀가루",
            "영양강화밀가루", "땅콩버터", "땅콩또는견과류가공품", "과채가공품", "곡류가공품",
            "두류가공품", "서류가공품", "기타농산가공품", "베이컨류", "건조저장육류", "양념육",
            "분쇄가공육제품", "식육추출가공품", "식육함유가공품", "전란액", "난황액", "난백액",
            "전란분", "난황분", "알가열제품", "피단", "알함유가공품", "산양유", "어육살", "연육",
            "어육반제품", "어묵", "기타어육가공품", "젓갈", "양념젓갈", "액젓", "조미액젓",
            "조미건어포", "건어포", "기타건포류", "조미김", "기타수산물가공품"
        ]
    },

    # 2024.12.30 개정 - 22년도 매출액 기준
    "2024개정": {
        "개정일": "2024.12.30",
        "근거": "식품 등의 표시ㆍ광고에 관한 법률 시행규칙 총리령 제2004호",
        "매출기준년도": 2022,
        "시행일": {
            "120억초과": "2026.01.01",
            "120억이하": "2028.01.01"
        },
        "식품유형": [
            "아이스크림믹스", "저지방아이스크림믹스", "아이스밀크믹스", "샤베트믹스",
            "비유지방아이스크림믹스", "설탕", "기타설탕", "당시럽류", "올리고당", "올리고당가공품",
            "포도당", "과당", "기타과당", "물엿", "기타엿", "덱스트린", "식용우지", "식용돈지",
            "원료우지", "원료돈지", "어유", "기타동물성유지", "모조치즈", "기타식용유지가공품",
            "고형차", "고혈압환자용영양조제식품", "수분및전해질보충용조제식품", "고혈압환자용식단형식품",
            "한식메주를사용한한식간장", "청국장", "카레분", "커리분", "고춧가루", "실고추", "절임배추",
            "찐쌀", "효소식품", "갈비가공품", "식육케이싱", "식육간편조리세트", "버터유", "농축우유",
            "탈지농축우유", "가당연유", "가당탈지연유", "가공연유", "유크림", "가공유크림", "버터",
            "가공버터", "버터오일", "유청", "농축유청", "유청단백분말", "유당", "유단백가수분해식품",
            "유함유가공품", "한천", "기타동물성가공식품", "곤충가공식품", "자라분말", "자라분말제품",
            "자라유제품", "추출가공식품", "벌집꿀", "벌꿀", "사양벌집꿀", "사양벌꿀", "로열젤리",
            "로열젤리제품", "가공화분", "화분함유제품", "생식제품", "생식함유제품", "신선편의식품",
            "간편조리세트", "효모식품", "기타가공품"
        ]
    },

    # 영양표시 제외 대상
    "제외대상": {
        "영양성분섭취목적아님": [
            "추잉껌", "식용얼음", "어업용얼음", "탁주", "약주", "청주", "맥주", "과실주",
            "소주", "위스키", "브랜디", "일반증류주", "리큐르", "기타주류", "주정"
        ],
        "영양성분함량적음": [
            "침출차", "볶은커피", "인스턴트커피", "조제커피", "희석초산", "천연향신료",
            "천일염", "제재소금", "태움용융소금", "정제소금", "기타소금", "가공소금"
        ],
        "표준화어려움": [
            "한식메주", "한식된장", "김치", "포장육", "기타식육", "기타알"
        ]
    }
}
